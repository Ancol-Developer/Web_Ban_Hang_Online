@model Entities.Product
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
	ViewBag.Title = "Thêm mới sản phẩm";
}

@section naviheader {
	<ul class="navbar-nav">
		<li class="nav-item">
			<a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
		</li>
		<li class="nav-item d-none d-sm-inline-block">
			<a href="/Admin/Home" class="nav-link">Trang chủ</a>
		</li>
		<li class="nav-item d-none d-sm-inline-block">
			<a href="/Admin/Products" class="nav-link">Sản phẩm</a>
		</li>
		<li class="nav-item d-none d-sm-inline-block">
			<a href="#" class="nav-link">Thêm mới</a>
		</li>
	</ul>
}

<!-- Content Header (Page header) -->
<section class="content-header">
	<div class="container-fluid">
		<div class="row mb-2">
			<div class="col-sm-6">
				<h1>Thêm mới sản phẩm</h1>
			</div>
			<div class="col-sm-6">
				<ol class="breadcrumb float-sm-right">
					<li class="breadcrumb-item"><a href="#">Sản phẩm</a></li>
					<li class="breadcrumb-item active">Thêm mới</li>
				</ol>
			</div>
		</div>
	</div><!-- /.container-fluid -->
</section>

<!-- Main content -->
<section class="content">

	<!-- Default box -->
	<div class="card">
		<div class="card-header">
			<h3 class="card-title">Thông tin thêm mới tin tức</h3>

			<div class="card-tools">
				<button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
					<i class="fas fa-minus"></i>
				</button>
				<button type="button" class="btn btn-tool" data-card-widget="remove" title="Remove">
					<i class="fas fa-times"></i>
				</button>
			</div>
		</div>
		<div class="card-body">
			<div class="row">
				<div class="col-md-12">
					@using (Html.BeginForm("Add", "Products", FormMethod.Post, new { }))
					{
						@Html.AntiForgeryToken()
						@Html.ValidationSummary(true)
						<div class="card">
							<div class="card-header p-2">
								<ul class="nav nav-pills">
									<li class="nav-item"><a class="nav-link active" href="#activity" data-toggle="tab">Thông tin chung</a></li>
									<li class="nav-item"><a class="nav-link" href="#timeline" data-toggle="tab">Hình ảnh</a></li>
									<li class="nav-item"><a class="nav-link" href="#settings" data-toggle="tab">SEO</a></li>
								</ul>
							</div><!-- /.card-header -->
							<div class="card-body">
								<div class="tab-content">
									<div class="active tab-pane" id="activity">
										<div class="form-group">
											<label for="exampleInputEmail1">Tên sản phẩm</label>
											@Html.TextBoxFor(x => x.Title, new { @class = "form-control", @placeholder = "Tên sản phẩm" })
											@Html.ValidationMessageFor(x => x.Title, null, new { @class = "text-danger" })
										</div>
										<div class="form-group">
											<label for="exampleInputEmail1">Alias</label>
											@Html.TextBoxFor(x => x.Alias, new { @class = "form-control", @placeholder = "Alias" })
											@Html.ValidationMessageFor(x => x.Alias, null, new { @class = "text-danger" })
										</div>
										<div class="form-group">
											<label for="exampleInputEmail1">SKU</label>
											@Html.TextBoxFor(x => x.ProductCode, new { @class = "form-control", @placeholder = "Mã sản phẩm" })
											@Html.ValidationMessageFor(x => x.ProductCode, null, new { @class = "text-danger" })
										</div>

										<div class="form-group">
											<label for="exampleInputEmail1">Danh mục</label>
											@Html.DropDownListFor(x => x.ProductCategoryId, ViewBag.ProductCategory as SelectList, "Chọn danh mục sản phẩm", new { @class = "form-control", @placeholder = "Mô tả" })
											@Html.ValidationMessageFor(x => x.ProductCategoryId, null, new { @class = "text-danger" })
										</div>

										<div class="form-group">
											<label for="exampleInputEmail1">Mô tả</label>
											@Html.TextAreaFor(x => x.Description, new { @class = "form-control", @placeholder = "Mô tả" })
											@Html.ValidationMessageFor(x => x.Description, null, new { @class = "text-danger" })
										</div>
										<div class="form-group">
											<label for="exampleInputEmail1">Chi tiết sản phẩm</label>
											@Html.TextAreaFor(x => x.Detail, new { @class = "form-control", @placeholder = "Chi tiết sản phẩm" })
											@Html.ValidationMessageFor(x => x.Detail, null, new { @class = "text-danger" })
										</div>
										<div class="row">
											<div class="col-4">
												<div class="form-group">
													<label for="exampleInputEmail1">Số lượng</label>
													@Html.TextBoxFor(x => x.Quantity, new { @class = "form-control", @placeholder = "Số lượng" })
													@Html.ValidationMessageFor(x => x.Quantity, null, new { @class = "text-danger" })
												</div>
											</div>
											<div class="col-4">
												<div class="form-group">
													<label for="exampleInputEmail1">Giá</label>
													@Html.TextBoxFor(x => x.Price, new { @class = "form-control", @placeholder = "Giá" })
													@Html.ValidationMessageFor(x => x.Price, null, new { @class = "text-danger" })
												</div>
											</div>
											<div class="col-4">
												<div class="form-group">
													<label for="exampleInputEmail1">Giá khuyến mãi</label>
													@Html.TextBoxFor(x => x.PriceSale, new { @class = "form-control", @placeholder = "Giá khuyến mãi" })
													@Html.ValidationMessageFor(x => x.PriceSale, null, new { @class = "text-danger" })
												</div>
											</div>
										</div>
										<div class="row">
											<div class="col-3">
												<div class="form-group">
													<div class="custom-control custom-checkbox">
														@Html.CheckBoxFor(x => x.IsActive, new { @class = "custom-control-input", @id = "IsActiveCheckbox" })
														<label for="IsActiveCheckbox" class="custom-control-label">Hiển thị</label>
													</div>
												</div>
											</div>
											<div class="col-3">
												<div class="form-group">
													<div class="custom-control custom-checkbox">
														@Html.CheckBoxFor(x => x.IsHot, new { @class = "custom-control-input", @id = "IsHotCheckbox" })
														<label for="IsHotCheckbox" class="custom-control-label">Hot</label>
													</div>
												</div>
											</div>
											<div class="col-3">
												<div class="form-group">
													<div class="custom-control custom-checkbox">
														@Html.CheckBoxFor(x => x.IsFeature, new { @class = "custom-control-input", @id = "IsFeatureCheckbox" })
														<label for="IsFeatureCheckbox" class="custom-control-label">Nổi bật</label>
													</div>
												</div>
											</div>
											<div class="col-3">
												<div class="form-group">
													<div class="custom-control custom-checkbox">
														@Html.CheckBoxFor(x => x.IsSale, new { @class = "custom-control-input", @id = "IsSaleCheckbox" })
														<label for="IsSaleCheckbox" class="custom-control-label">Khuyến mãi</label>
													</div>
												</div>
											</div>
										</div>
									</div>
									<!-- /.tab-pane -->
									<div class="tab-pane" id="timeline">
										<div class="row">
											<div class="col-md-12">
												@await Html.PartialAsync("_PartialImportImage", null)
												<input type="hidden" id="uploadedImages" name="UploadedImages" />
											</div>
										</div>
									</div>
									<!-- /.tab-pane -->

									<div class="tab-pane" id="settings">
										<form class="form-horizontal">
											<div class="form-group row">
												<label for="inputName" class="col-sm-2 col-form-label">SEO Title</label>
												<div class="col-sm-10">
													<div class="form-group">
														@Html.TextBoxFor(x => x.SeoTitle, new { @class = "form-control", @placeholder = "Seo Title" })
														@Html.ValidationMessageFor(x => x.SeoTitle, null, new { @class = "text-danger" })
													</div>
												</div>
											</div>
											<div class="form-group row">
												<label for="inputEmail" class="col-sm-2 col-form-label">Seo Keywords</label>
												<div class="col-sm-10">
													@Html.TextBoxFor(x => x.SeoKeywords, new { @class = "form-control", @placeholder = "Seo Keywords" })
													@Html.ValidationMessageFor(x => x.SeoKeywords, null, new { @class = "text-danger" })
												</div>
											</div>
											<div class="form-group row">
												<label for="inputName2" class="col-sm-2 col-form-label">Seo Description</label>
												<div class="col-sm-10">
													@Html.TextBoxFor(x => x.SeoDescription, new { @class = "form-control", @placeholder = "Seo Description" })
													@Html.ValidationMessageFor(x => x.SeoDescription, null, new { @class = "text-danger" })
												</div>
											</div>
										</form>
									</div>
									<!-- /.tab-pane -->
								</div>
								<!-- /.tab-content -->
							</div><!-- /.card-body -->
						</div>
					}
				</div>
			</div>
			<!-- /.card-body -->
			<div class="card-footer">
				Visit <a href="https://github.com/Johann-S/bs-stepper/#how-to-use-it">bs-stepper documentation</a> for more examples and information about the plugin.
			</div>
		</div>
		<!-- /.card -->
		<!-- /.card-body -->
		<div class="card-footer">
		</div>
		<!-- /.card-footer-->
	</div>
	<!-- /.card -->

</section>
<!-- /.content -->
@section scripts {
	<script>
		$(document).ready(function (){
			$('#upload-images-btn').on('click', function () {
				var formData = new FormData();

				// Get files from input and add to FormData
				var files = $('#images')[0].files;
				if (files.length === 0) {
					alert('Please select a file before uploading.');
					return;
				}

				for (var i = 0; i < files.length; i++) {
					formData.append('images', files[i]);
				}

				$.ajax({
					url: '/Admin/Products/UploadImages',
					type: 'post',
					data: formData,
					processData: false,
					contentType: false,
					success: function(uploadedImages){
						// Display image
						var imageContainer = $('#uploaded-images');
						imageContainer.empty();

						uploadedImages.forEach(function (imagePath) {
						imageContainer.append('<img src="' + imagePath + '" alt="Uploaded Image" style="max-width: 150px; margin: 5px;" />');
						});

						// Update hidden imput in main form
						var existingImages = $('#uploadedImages').val();
						var allImages = existingImages ? existingImages.split(',') : [];
						$('#uploadedImages').val(allImages.join(','));
					}
				});
			});
		});
	</script>
}